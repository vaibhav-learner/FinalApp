<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Analyzer & Cooking Agent</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 1000px; margin: 40px auto; padding: 20px; line-height: 1.6; background-color: #f8f9fa; }
        .container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        
        /* Tabs Navigation */
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #e0e0e0; }
        .tab-btn { background: none; border: none; padding: 12px 20px; cursor: pointer; font-size: 16px; font-weight: 500; color: #6c757d; border-bottom: 3px solid transparent; transition: all 0.3s; }
        .tab-btn.active { color: #007bff; border-bottom-color: #007bff; }
        .tab-btn:hover { color: #007bff; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .upload-section { border: 2px dashed #007bff; padding: 20px; text-align: center; border-radius: 8px; margin-bottom: 20px; }
        .btn { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; transition: background 0.3s; }
        .btn:hover { background: #0056b3; }
        .btn:disabled { background: #ccc; }
        .btn-secondary { background: #6c757d; }
        .btn-secondary:hover { background: #5a6268; }
        
        /* Form Styling */
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-weight: bold; margin-bottom: 5px; color: #495057; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; box-sizing: border-box; }
        .form-group textarea { resize: vertical; min-height: 100px; font-family: 'Courier New', monospace; }
        
        /* Result Card Styling */
        .card { border: 1px solid #e0e0e0; border-radius: 8px; margin-top: 20px; overflow: hidden; }
        .card-header { background: #007bff; color: white; padding: 10px 15px; font-weight: bold; }
        .card-body { padding: 20px; background: #fff; }
        .label { font-weight: bold; color: #495057; display: block; margin-top: 10px; }
        
        /* Chat Styling */
        .chat-box { border: 1px solid #ddd; border-radius: 8px; height: 400px; overflow-y: auto; padding: 15px; background: #f9f9f9; margin-bottom: 15px; }
        .chat-message { margin-bottom: 12px; padding: 10px; border-radius: 5px; }
        .chat-message.user { background: #007bff; color: white; text-align: right; }
        .chat-message.agent { background: #e9ecef; color: #333; }
        .chat-input-group { display: flex; gap: 10px; }
        .chat-input-group input { flex: 1; }
        .chat-input-group button { width: 100px; }
        
        /* Spinner Styling */
        #loader { display: none; margin: 20px auto; border: 4px solid #f3f3f3; border-top: 4px solid #007bff; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .loading-text { display: none; text-align: center; color: #007bff; margin: 10px 0; }
        
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
    </style>
</head>
<body>

<div class="container">
    <h1>üçΩÔ∏è PDF Analyzer & Cooking AI Agent</h1>
    <p>Upload PDFs and interact with the AI-powered cooking assistant.</p>

    <!-- Tabs Navigation -->
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('pdf')">üìÑ PDF Analyzer</button>
        <button class="tab-btn" onclick="switchTab('cooking')">üç≥ Cooking Agent</button>
        <button class="tab-btn" onclick="switchTab('recipes')">üìñ Find Recipes</button>
        <button class="tab-btn" onclick="switchTab('ingredients')">ü•ò Extract Ingredients</button>
    </div>

    <!-- PDF Analyzer Tab -->
    <div id="pdf" class="tab-content active">
        <div class="upload-section">
            <form action="/upload" method="post" enctype="multipart/form-data" onsubmit="showLoading()">
                <input type="file" name="file" accept=".pdf" required>
                <br><br>
                <button type="submit" id="submitBtn" class="btn">Analyze PDF</button>
            </form>
        </div>

        <div id="loader"></div>
        <p id="loadingText" class="loading-text">Gemini is analyzing your document...</p>

        {% if result %}
        <div class="card">
            <div class="card-header">Extraction Results: {{ result.filename }}</div>
            <div class="card-body">
                <span class="label">Product/Report Title:</span>
                <div>{{ result.title }}</div>

                <span class="label">Author/Organization:</span>
                <div>{{ result.author }}</div>

                <span class="label">AI Summary:</span>
                <div style="background: #f1f3f5; padding: 15px; border-radius: 5px; margin-top: 5px;">
                    {{ result.summary }}
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Cooking Agent Chat Tab -->
    <div id="cooking" class="tab-content">
        <h2>üí¨ Chat with Cooking Agent</h2>
        <p>Ask your cooking AI chef any questions about recipes, cooking tips, and ingredients!</p>
        
        <div class="chat-box" id="chatBox"></div>
        
        <div class="chat-input-group">
            <input type="text" id="chatInput" placeholder="Ask something like 'What can I make with tomato and garlic?'" onkeypress="handleChatKeypress(event)">
            <button class="btn" onclick="sendChatMessage()">Send</button>
        </div>
        
        <div id="chatLoader" class="loading-text">Chef is thinking...</div>
        <div id="chatError"></div>
    </div>

    <!-- Recipe Search Tab -->
    <div id="recipes" class="tab-content">
        <h2>üìñ Search Recipes by Ingredients</h2>
        
        <div class="form-group">
            <label for="ingredients">Enter Ingredients (comma-separated):</label>
            <input type="text" id="ingredients" placeholder="e.g., tomato, garlic, olive oil" />
        </div>
        
        <div class="form-group">
            <label for="cuisine">Cuisine Type (optional):</label>
            <select id="cuisine">
                <option value="any">Any Cuisine</option>
                <option value="Italian">Italian</option>
                <option value="Asian">Asian</option>
                <option value="Mexican">Mexican</option>
            </select>
        </div>
        
        <button class="btn" onclick="searchRecipes()">Search Recipes</button>
        
        <div id="recipesLoader" class="loading-text">Searching recipes...</div>
        <div id="recipesResult"></div>
        <div id="recipesError"></div>
    </div>

    <!-- Ingredient Extraction Tab -->
    <div id="ingredients" class="tab-content">
        <h2>ü•ò Extract Ingredients from Recipe</h2>
        <p>Paste a recipe and we'll extract all the ingredients for you!</p>
        
        <div class="form-group">
            <label for="recipeText">Paste Recipe Text:</label>
            <textarea id="recipeText" placeholder="Paste your recipe here..."></textarea>
        </div>
        
        <button class="btn" onclick="extractIngredients()">Extract Ingredients</button>
        
        <div id="extractLoader" class="loading-text">Extracting ingredients...</div>
        <div id="extractResult"></div>
        <div id="extractError"></div>
    </div>

</div>

<script>
    // Tab Switching
    function switchTab(tabName) {
        // Hide all tabs
        const tabs = document.querySelectorAll('.tab-content');
        tabs.forEach(tab => tab.classList.remove('active'));
        
        // Remove active class from all buttons
        const buttons = document.querySelectorAll('.tab-btn');
        buttons.forEach(btn => btn.classList.remove('active'));
        
        // Show selected tab
        document.getElementById(tabName).classList.add('active');
        event.target.classList.add('active');
    }

    // PDF Upload Loading
    function showLoading() {
        document.getElementById('submitBtn').disabled = true;
        document.getElementById('loader').style.display = 'block';
        document.getElementById('loadingText').style.display = 'block';
    }

    // Chat Functions
    function appendChatMessage(message, isUser = false) {
        const chatBox = document.getElementById('chatBox');
        const messageDiv = document.createElement('div');
        messageDiv.className = `chat-message ${isUser ? 'user' : 'agent'}`;
        messageDiv.textContent = message;
        chatBox.appendChild(messageDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    function handleChatKeypress(event) {
        if (event.key === 'Enter') {
            sendChatMessage();
        }
    }

    async function sendChatMessage() {
        const input = document.getElementById('chatInput');
        const message = input.value.trim();
        
        if (!message) return;
        
        // Show user message
        appendChatMessage(message, true);
        input.value = '';
        
        // Show loader
        const loader = document.getElementById('chatLoader');
        const error = document.getElementById('chatError');
        loader.style.display = 'block';
        error.style.display = 'none';
        error.innerHTML = '';
        
        try {
            const response = await fetch('/api/cooking/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: message })
            });
            
            const data = await response.json();
            loader.style.display = 'none';
            
            if (data.status === 'success') {
                appendChatMessage(data.response, false);
            } else {
                error.innerHTML = `<div class="error">Error: ${data.error}</div>`;
                error.style.display = 'block';
            }
        } catch (err) {
            loader.style.display = 'none';
            error.innerHTML = `<div class="error">Error: ${err.message}</div>`;
            error.style.display = 'block';
        }
    }

    // Recipe Search Functions
    async function searchRecipes() {
        const ingredients = document.getElementById('ingredients').value.trim();
        const cuisine = document.getElementById('cuisine').value;
        const resultDiv = document.getElementById('recipesResult');
        const loader = document.getElementById('recipesLoader');
        const error = document.getElementById('recipesError');
        
        if (!ingredients) {
            error.innerHTML = '<div class="error">Please enter at least one ingredient.</div>';
            error.style.display = 'block';
            return;
        }
        
        loader.style.display = 'block';
        error.style.display = 'none';
        resultDiv.innerHTML = '';
        
        try {
            const response = await fetch(`/api/cooking/recipes?ingredients=${encodeURIComponent(ingredients)}&cuisine=${encodeURIComponent(cuisine)}`);
            const data = await response.json();
            loader.style.display = 'none';
            
            if (data.status === 'success') {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="card-header">üç≥ Recipe Search Results</div>
                    <div class="card-body">
                        <div class="label">Cuisine:</div>
                        <div>${data.cuisine}</div>
                        <div class="label">Ingredients Searched:</div>
                        <div>${data.ingredients.join(', ')}</div>
                        <div class="label">Recipes Found:</div>
                        <div style="background: #f1f3f5; padding: 15px; border-radius: 5px; margin-top: 5px; white-space: pre-wrap;">
                            ${data.recipes}
                        </div>
                    </div>
                `;
                resultDiv.appendChild(card);
            } else {
                error.innerHTML = `<div class="error">Error: ${data.error}</div>`;
                error.style.display = 'block';
            }
        } catch (err) {
            loader.style.display = 'none';
            error.innerHTML = `<div class="error">Error: ${err.message}</div>`;
            error.style.display = 'block';
        }
    }

    // Ingredient Extraction Functions
    async function extractIngredients() {
        const recipeText = document.getElementById('recipeText').value.trim();
        const resultDiv = document.getElementById('extractResult');
        const loader = document.getElementById('extractLoader');
        const error = document.getElementById('extractError');
        
        if (!recipeText) {
            error.innerHTML = '<div class="error">Please paste a recipe first.</div>';
            error.style.display = 'block';
            return;
        }
        
        loader.style.display = 'block';
        error.style.display = 'none';
        resultDiv.innerHTML = '';
        
        try {
            const response = await fetch('/api/cooking/extract-ingredients', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ recipe_text: recipeText })
            });
            
            const data = await response.json();
            loader.style.display = 'none';
            
            if (data.status === 'success') {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="card-header">ü•ò Extracted Ingredients</div>
                    <div class="card-body">
                        <div style="background: #f1f3f5; padding: 15px; border-radius: 5px; white-space: pre-wrap;">
                            ${data.ingredients}
                        </div>
                    </div>
                `;
                resultDiv.appendChild(card);
            } else {
                error.innerHTML = `<div class="error">Error: ${data.error}</div>`;
                error.style.display = 'block';
            }
        } catch (err) {
            loader.style.display = 'none';
            error.innerHTML = `<div class="error">Error: ${err.message}</div>`;
            error.style.display = 'block';
        }
    }
</script>

</body>
</html>